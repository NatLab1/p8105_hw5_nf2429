---
title: "HW5"
author: "Nathalie Fadel"
date: "11/7/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rvest)
library(purrr)
set.seed(1)
```

#Problem 1
```{r}
names = list.files("./data", full.names = TRUE)

df = names %>%
  map(read_csv)

for (i in 1:20)
  if (i <= 10) {
    df[[i]] = df[[i]] %>% 
      mutate(arm = "Control", study_id = i)
  } else if (i > 10) {
    df[[i]] = df[[i]] %>% 
      mutate(arm = "Experimental", study_id = i - 10)
  }

df = bind_rows(df) %>%
  gather(key = "week", week_1:week_8, value = "value") %>%
  mutate(week = as.numeric(str_extract(week, "\\d"))) 
data = df

data %>%
  mutate(study_id = as.character(study_id)) %>%
  group_by(arm, study_id) %>%
  ggplot(aes(x = week, y = value, color = arm, type = study_id)) +
  geom_line() +
  labs(y = "value", caption = "response per subject over time")
```

#Problem 2
```{r}
murder_data = read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")

murder_data = murder_data %>%
  unite("city_state", c("city", "state"), sep = ",", remove = TRUE)

unsolved_cases =
  murder_data %>%
  filter(disposition %in% c("Open/No arrest", "Closed without arrest")) %>%
  group_by(city_state) %>%
  summarize(unsolved_cases = n())

total_murders =
  murder_data %>%
  group_by(city_state) %>%
  summarize(total_murders = n())

total_cases = 
  left_join(unsolved_cases, total_murders, by = "city_state")

prop.test(x, n, p = NULL,
          alternative = c("two.sided", "less", "greater"),
          conf.level = 0.95, correct = TRUE)
```